# server
server.port=${SERVER_PORT:8080}
server.servlet.context-path=/

# application name
spring.application.name=toptuna-gateway

# -----------------------------
# Routes: forward API requests AS-IS (no stripping)
# -----------------------------

# 0 = auth (forward /api/auth/** unchanged)
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=${AUTH_URL:http://auth:8081}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**

# 1..3 = catalog (actuator health rewrite + normal pass-through)
spring.cloud.gateway.routes[1].id=catalog-actuator-health
spring.cloud.gateway.routes[1].uri=${CATALOG_URL:http://catalog:8082}
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/catalog/health
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/api/catalog/health, /actuator/health

spring.cloud.gateway.routes[2].id=catalog-actuator-all
spring.cloud.gateway.routes[2].uri=${CATALOG_URL:http://catalog:8082}
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/catalog/actuator/** 
spring.cloud.gateway.routes[2].filters[0]=RewritePath=/api/catalog/actuator/(?<remaining>.*), /actuator/${remaining}

spring.cloud.gateway.routes[3].id=catalog-service
spring.cloud.gateway.routes[3].uri=${CATALOG_URL:http://catalog:8082}
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/catalog/**

# 4..6 = orders
spring.cloud.gateway.routes[4].id=orders-actuator-health
spring.cloud.gateway.routes[4].uri=${ORDERS_URL:http://orders:8083}
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/orders/health
spring.cloud.gateway.routes[4].filters[0]=RewritePath=/api/orders/health, /actuator/health

spring.cloud.gateway.routes[5].id=orders-actuator-all
spring.cloud.gateway.routes[5].uri=${ORDERS_URL:http://orders:8083}
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/orders/actuator/** 
spring.cloud.gateway.routes[5].filters[0]=RewritePath=/api/orders/actuator/(?<remaining>.*), /actuator/${remaining}

spring.cloud.gateway.routes[6].id=orders-service
spring.cloud.gateway.routes[6].uri=${ORDERS_URL:http://orders:8083}
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/orders/**

# 7..9 = logistics
spring.cloud.gateway.routes[7].id=logistics-actuator-health
spring.cloud.gateway.routes[7].uri=${LOGISTICS_URL:http://logistics:8084}
spring.cloud.gateway.routes[7].predicates[0]=Path=/api/logistics/health
spring.cloud.gateway.routes[7].filters[0]=RewritePath=/api/logistics/health, /actuator/health

spring.cloud.gateway.routes[8].id=logistics-actuator-all
spring.cloud.gateway.routes[8].uri=${LOGISTICS_URL:http://logistics:8084}
spring.cloud.gateway.routes[8].predicates[0]=Path=/api/logistics/actuator/** 
spring.cloud.gateway.routes[8].filters[0]=RewritePath=/api/logistics/actuator/(?<remaining>.*), /actuator/${remaining}

spring.cloud.gateway.routes[9].id=logistics-service
spring.cloud.gateway.routes[9].uri=${LOGISTICS_URL:http://logistics:8084}
spring.cloud.gateway.routes[9].predicates[0]=Path=/api/logistics/**

# 10..12 = crm
spring.cloud.gateway.routes[10].id=crm-actuator-health
spring.cloud.gateway.routes[10].uri=${CRM_URL:http://crm:8085}
spring.cloud.gateway.routes[10].predicates[0]=Path=/api/crm/health
spring.cloud.gateway.routes[10].filters[0]=RewritePath=/api/crm/health, /actuator/health

spring.cloud.gateway.routes[11].id=crm-actuator-all
spring.cloud.gateway.routes[11].uri=${CRM_URL:http://crm:8085}
spring.cloud.gateway.routes[11].predicates[0]=Path=/api/crm/actuator/** 
spring.cloud.gateway.routes[11].filters[0]=RewritePath=/api/crm/actuator/(?<remaining>.*), /actuator/${remaining}

spring.cloud.gateway.routes[12].id=crm-service
spring.cloud.gateway.routes[12].uri=${CRM_URL:http://crm:8085}
spring.cloud.gateway.routes[12].predicates[0]=Path=/api/crm/**

# 13..15 = export
spring.cloud.gateway.routes[13].id=export-actuator-health
spring.cloud.gateway.routes[13].uri=${EXPORT_URL:http://export:8086}
spring.cloud.gateway.routes[13].predicates[0]=Path=/api/export/health
spring.cloud.gateway.routes[13].filters[0]=RewritePath=/api/export/health, /actuator/health

spring.cloud.gateway.routes[14].id=export-actuator-all
spring.cloud.gateway.routes[14].uri=${EXPORT_URL:http://export:8086}
spring.cloud.gateway.routes[14].predicates[0]=Path=/api/export/actuator/** 
spring.cloud.gateway.routes[14].filters[0]=RewritePath=/api/export/actuator/(?<remaining>.*), /actuator/${remaining}

spring.cloud.gateway.routes[15].id=export-service
spring.cloud.gateway.routes[15].uri=${EXPORT_URL:http://export:8086}
spring.cloud.gateway.routes[15].predicates[0]=Path=/api/export/**

# -----------------------------
# CORS / management / timeouts
# -----------------------------
toptuna.cors.allowed-origins=${GATEWAY_ALLOWED_ORIGINS:http://localhost:4200}

management.endpoints.web.exposure.include=health,info,metrics,env,loggers
management.endpoint.health.show-details=always

spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=300000
spring.cloud.gateway.default-filters[0]=Retry=3,BAD_GATEWAY,GATEWAY_TIMEOUT

# logging
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.com.toptuna=DEBUG
